<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Empty Rows Functionality</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .test-container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }

        .test-section {
            margin-bottom: 30px;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
        }

        .print-preview {
            border: 1px solid #ccc;
            padding: 20px;
            background: white;
            margin-top: 10px;
        }

        .empty-row {
            background-color: #f8f9fa;
            border-left: 3px solid #dee2e6;
        }

        /* Hide colon for empty category rows */
        .empty-category-row td:nth-child(2)::before {
            content: "" !important;
        }
    </style>
</head>

<body>
    <div class="test-container">
        <h1>Test Empty Rows Functionality</h1>

        <div class="test-section">
            <h3>Test Data with Empty Rows</h3>
            <p>This test simulates the scenario from your image where there are empty/nameless sub-category rows that
                should be preserved in print output.</p>

            <table class="table table-sm table-striped">
                <thead class="table-light">
                    <tr>
                        <th>Category</th>
                        <th>Value</th>
                        <th>UOM</th>
                        <th>Ref Range</th>
                        <th>Remark</th>
                    </tr>
                </thead>
                <tbody id="testTableBody">
                    <tr>
                        <td>RBC</td>
                        <td><input type="text" class="form-control form-control-sm" value="4.2"></td>
                        <td>M/uL</td>
                        <td>3.5 - 6</td>
                        <td><input type="text" class="form-control form-control-sm" value="Normal"></td>
                    </tr>
                    <tr>
                        <td>FTC</td>
                        <td><input type="text" class="form-control form-control-sm" value="42"></td>
                        <td>%</td>
                        <td>36 - 50</td>
                        <td><input type="text" class="form-control form-control-sm" value="Normal"></td>
                    </tr>
                    <tr>
                        <td>MCV</td>
                        <td><input type="text" class="form-control form-control-sm" value="88"></td>
                        <td>fL</td>
                        <td>80 - 96</td>
                        <td><input type="text" class="form-control form-control-sm" value="Normal"></td>
                    </tr>
                    <tr class="empty-row">
                        <td>&nbsp;</td>
                        <td><input type="text" class="form-control form-control-sm" placeholder="Enter value"></td>
                        <td></td>
                        <td></td>
                        <td><input type="text" class="form-control form-control-sm" placeholder="Enter remark"></td>
                    </tr>
                    <tr>
                        <td>EMPTY</td>
                        <td><input type="text" class="form-control form-control-sm" value="100"></td>
                        <td>$</td>
                        <td>22 - 3332</td>
                        <td><input type="text" class="form-control form-control-sm" value="Normal"></td>
                    </tr>
                </tbody>
            </table>

            <button class="btn btn-primary" onclick="testPrintGeneration()">Test Print Generation</button>
        </div>

        <div class="test-section">
            <h3>Print Preview</h3>
            <p>This shows how the data would appear in the print output:</p>
            <div class="print-preview" id="printPreview">
                <p>Click "Test Print Generation" to see the preview</p>
            </div>
        </div>
    </div>

    <script>
        // Simulate the generatePrintableResultsHTML function
        function generatePrintableResultsHTML(includeRemark = true, includeUnit = true) {
            const tbody = document.getElementById('testTableBody');
            if (!tbody) return "";
            const rows = Array.from(tbody.querySelectorAll("tr"));
            if (!rows.length) return "";

            const html = rows
                .map((row) => {
                    const cells = row.querySelectorAll("td");
                    if (cells.length < 4) return "";
                    const category = (cells[0]?.textContent || "").trim();
                    const value = cells[1]?.querySelector("input")?.value || "";
                    const uom = (cells[2]?.textContent || "").trim();
                    const ref = (cells[3]?.textContent || "").trim();
                    const remark = cells[4]?.querySelector("input")?.value || "";
                    const hasAny =
                        category ||
                        value ||
                        (includeUnit && uom) ||
                        ref ||
                        (includeRemark && remark);

                    // If no category name (empty/nameless sub-category row), preserve as empty space
                    // This ensures empty rows are maintained in print output like in the image
                    if (!category) {
                        if (includeRemark && includeUnit) {
                            return `<tr class="empty-category-row">
                                <td>&nbsp;</td>
                                <td>${safeText(value)}</td>
                                <td>${safeText(uom)}</td>
                                <td>${safeText(ref)}</td>
                                <td>${safeText(remark)}</td>
                            </tr>`;
                        }
                        if (!includeRemark && includeUnit) {
                            return `<tr class="empty-category-row">
                                <td>&nbsp;</td>
                                <td>${safeText(value)}</td>
                                <td>${safeText(uom)}</td>
                                <td>${safeText(ref)}</td>
                            </tr>`;
                        }
                        // No UNIT and no REMARK
                        return `<tr class="empty-category-row">
                            <td>&nbsp;</td>
                            <td>${safeText(value)}</td>
                            <td>${safeText(ref)}</td>
                        </tr>`;
                    }

                    // Skip completely empty rows (no category and no other data)
                    if (!hasAny) return "";

                    if (includeRemark && includeUnit) {
                        return `<tr>
                            <td>${safeText(category)}</td>
                            <td>${safeText(value)}</td>
                            <td>${safeText(uom)}</td>
                            <td>${safeText(ref)}</td>
                            <td>${safeText(remark)}</td>
                        </tr>`;
                    }
                    if (!includeRemark && includeUnit) {
                        return `<tr>
                            <td>${safeText(category)}</td>
                            <td>${safeText(value)}</td>
                            <td>${safeText(uom)}</td>
                            <td>${safeText(ref)}</td>
                        </tr>`;
                    }
                    // No UNIT and no REMARK
                    return `<tr>
                        <td>${safeText(category)}</td>
                        <td>${safeText(value)}</td>
                        <td>${safeText(ref)}</td>
                    </tr>`;
                })
                .filter(Boolean)
                .join("");

            const colspan = includeRemark ? (includeUnit ? 5 : 4) : includeUnit ? 4 : 3;
            return html || `<tr><td colspan="${colspan}" style="text-align:center;color:#777;">No results entered</td></tr>`;
        }

        function safeText(value) {
            return value == null ? "" : String(value);
        }

        function testPrintGeneration() {
            const printHTML = generatePrintableResultsHTML(true, true);
            const preview = document.getElementById('printPreview');

            preview.innerHTML = `
                <h4>Print Output Preview</h4>
                <table class="table table-sm table-bordered">
                    <thead class="table-light">
                        <tr>
                            <th>Category</th>
                            <th>Value</th>
                            <th>UOM</th>
                            <th>Ref Range</th>
                            <th>Remark</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${printHTML}
                    </tbody>
                </table>
                <div class="alert alert-info">
                    <strong>Note:</strong> The empty row (4th row) is preserved with an empty category cell, 
                    maintaining the spacing as shown in your reference image. This ensures that when printed, 
                    the gap between MCV and EMPTY is maintained. The colon ":" is not displayed for empty rows.
                </div>
            `;
        }
    </script>
</body>

</html>